

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.3.2. Installation &mdash; Holmes Processing 0.5.0 alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="5.4. Holmes Gateway" href="../holmes-gateway/index.html" />
    <link rel="prev" title="5.3.1. Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Holmes Processing
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/index.html">2. Architecture Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">3. Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../depolyment_strategies/index.html">4. Deployment Strategies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">5. Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../holmes-totem/index.html">5.1. Holmes Totem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../holmes-totem-dynamic/index.html">5.2. Holmes Totem Dynamic</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">5.3. Holmes Storage</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">5.3.1. Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">5.3.2. Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">5.3.2.1. Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">5.3.2.2. Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">5.3.2.3. Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#best-practices">5.3.2.4. Best Practices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../holmes-gateway/index.html">5.4. Holmes Gateway</a></li>
<li class="toctree-l2"><a class="reference internal" href="../holmes-interrogation/index.html">5.5. Holmes Interrogation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../holmes-presentation/index.html">5.6. Holmes Presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transport/index.html">5.7. Transport</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../toolbox/index.html">6. Toolbox and Helper Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">7. FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Holmes Processing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">5. Components</a> &raquo;</li>
        
          <li><a href="index.html">5.3. Holmes Storage</a> &raquo;</li>
        
      <li>5.3.2. Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/rst/components/holmes-storage/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>5.3.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dependencies">
<h2>5.3.2.1. Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supported-databases">
<h3>5.3.2.1.1. Supported Databases<a class="headerlink" href="#supported-databases" title="Permalink to this headline">¶</a></h3>
<p>Holmes-Storage supports multiple databases and splits them into two categories: Object Stores and Document Stores. Object Stores are responsible for storing the file-based malicious objects collected by the analyst: binary files such as PE32 and ELF, PDFs, HTML code, Zips files etc. Document Stores contain the output of Holmes-Totem and Holmes-Totem-Dynamic Services. This was done to enable users to more easily select their preferred solutions while also allowing the mixing of databases for optimization purposes. In production environments, we strongly recommend using an <a class="reference external" href="https://aws.amazon.com/documentation/s3/">S3</a> compatible Object Store, such as <a class="reference external" href="http://docs.basho.com/riak/cs/2.1.1/">RIAK-CS</a>, and a clustered deployment of <a class="reference external" href="http://cassandra.apache.org">Cassandra</a> for the Document Stores.</p>
</div>
<div class="section" id="object-stores">
<h3>5.3.2.1.2. Object Stores<a class="headerlink" href="#object-stores" title="Permalink to this headline">¶</a></h3>
<p>We support two primary object storage databases.</p>
<ul class="simple">
<li><p>S3 compatible</p></li>
<li><p>(Soon) MongoDB Gridfs</p></li>
</ul>
<p>There are several tools you can use for implementing Object Stores. Depending on the intended scale of your work with Holmes-Storage, we would recommend:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 25%" />
<col style="width: 27%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Framework</p></th>
<th class="head"><p>Workstation</p></th>
<th class="head"><p>Mid-scale</p></th>
<th class="head"><p>Large-scale</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AWS</p></td>
<td><p>[]</p></td>
<td><p>[]</p></td>
<td><p>[x]</p></td>
</tr>
<tr class="row-odd"><td><p>RIAK-CS</p></td>
<td><p>[]</p></td>
<td><p>[]</p></td>
<td><p>[x]</p></td>
</tr>
<tr class="row-even"><td><p>LeoFS</p></td>
<td><p>[]</p></td>
<td><p>[]</p></td>
<td><p>[x]</p></td>
</tr>
<tr class="row-odd"><td><p>Pithos</p></td>
<td><p>[]</p></td>
<td><p>[x]</p></td>
<td><p>[]</p></td>
</tr>
<tr class="row-even"><td><p>Minio</p></td>
<td><p>[]</p></td>
<td><p>[x]</p></td>
<td><p>[]</p></td>
</tr>
<tr class="row-odd"><td><p>Fake-S3</p></td>
<td><p>[x]</p></td>
<td><p>[]</p></td>
<td><p>[]</p></td>
</tr>
</tbody>
</table>
<p>If you want to run Holmes-Storage on your local machine for testing or development purposes, we recommend you use lightweight servers compatible with the Amazon S3 API. This will make the installation and usage of Holmes-Storage faster and more efficient. There are several great options to fulfill this role: <a class="reference external" href="https://github.com/jubos/fake-s3">Fake-S3</a>, <a class="reference external" href="https://github.com/minio/minio">Minio</a>, <a class="reference external" href="http://pithos.io">Pithos</a> etc. The above-mentioned frameworks are only suggestions, any S3 compatible storage will do. Check out their documentation to find out which option is more suitable for the work you intend to do.</p>
</div>
<div class="section" id="document-stores">
<h3>5.3.2.1.3. Document Stores<a class="headerlink" href="#document-stores" title="Permalink to this headline">¶</a></h3>
<p>We support two primary object storage databases.</p>
<ul class="simple">
<li><p>Cassandra</p></li>
<li><p>MongoDB</p></li>
</ul>
<p>We recommend a Cassandra cluster for large deployments.</p>
</div>
</div>
<div class="section" id="configuration">
<h2>5.3.2.2. Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>5.3.2.2.1. RiakCS<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>It is recommended to use <a class="reference external" href="http://docs.basho.com/riak/cs/2.1.1/">RIAK-CS</a> only for large scale or industry deployments. Follow <a class="reference external" href="http://docs.basho.com/riak/cs/2.1.1/tutorials/fast-track/local-testing-environment/">this</a> tutorial for installation of RiakCS.</p>
<p>After successful installation, the user’s access key and secret key are returned in the key_id and key_secret fields respectively. Use these keys to update key and secret your config file ( <code class="docutils literal notranslate"><span class="pre">storage.conf.example</span></code> )</p>
<p>Holmes-Storage uses Amazon S3 signature version 4 for authentication. To enable authV4 on riak-cs, add <code class="docutils literal notranslate"><span class="pre">{auth_v4_enabled,</span> <span class="pre">true}</span></code> to advanced.config file ( should be in <code class="docutils literal notranslate"><span class="pre">/riak-cs/etc/</span></code>)</p>
</div>
<div class="section" id="fake-s3">
<h3>5.3.2.2.2. Fake-S3<a class="headerlink" href="#fake-s3" title="Permalink to this headline">¶</a></h3>
<p>We recommend <a class="reference external" href="https://github.com/jubos/fake-s3">Fake-S3</a> as a simple starting point for exploring the system functionality. Most of the current developers of Holmes-Storage are using <a class="reference external" href="https://github.com/jubos/fake-s3">Fake-S3</a> for quick testing purposes. <a class="reference external" href="https://github.com/minio/minio">Minio</a> is also encouraged if you want to engage more with development and do more testing.</p>
<p>Check out the documentation of <a class="reference external" href="https://github.com/jubos/fake-s3">Fake-S3</a> on how to install and run it.
Afterwards, go to <code class="docutils literal notranslate"><span class="pre">/config/storage.conf</span></code> of Holmes-Storage and set the IP and Port your ObjectStorage server is running on. You can decide whether you want your Holmes client to send HTTP or HTTPS requests to the server through the Secure parameter.</p>
</div>
<div class="section" id="id2">
<h3>5.3.2.2.3. Cassandra<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Holmes-Storage supports single node or cluster installation of Cassandra version 3.10 and higher. The version requirement is because of the significant improvement in system performance when leveraging the newly introduced <a class="reference external" href="https://github.com/apache/cassandra/blob/trunk/doc/SASI.md">SASIIndex</a> for secondary indexing and <a class="reference external" href="https://www.datastax.com/dev/blog/new-in-cassandra-3-0-materialized-views">Materialized Views</a>. We highly recommend deploying Cassandra as a cluster with a minimum of three Cassandra nodes in production environments.</p>
<p>New Cassandra clusters will need to be configured before Cassandra is started for the first time.
We have highlighted a few of the configuration options that are critical or will improve performance. For additional options, please see the <a class="reference external" href="https://www.datastax.com/dev/blog/new-in-cassandra-3-0-materialized-views">Cassandra installation guide</a>.</p>
<p>To edit these values, please open the Cassandra configuration file in your favorite editor. The Cassandra configuration file is typically located in <code class="docutils literal notranslate"><span class="pre">/etc/cassandra/cassandra.yaml</span></code>.</p>
<p>The Cassandra “cluster_name” must be set and the same on all nodes. The name you select does not much matter but again it should be identical on all nodes. <code class="docutils literal notranslate"><span class="pre">cluster_name:</span> <span class="pre">'Holmes</span> <span class="pre">Processing'</span></code></p>
<p>Cassandra 3.x has an improved token allocation algorithm. As such, 256 is not necessary and should be decreased to 64 or 128 tokens. <code class="docutils literal notranslate"><span class="pre">num_tokens:</span> <span class="pre">128</span></code></p>
<p>You should populate the “seeds” value with the IP addresses for at least two additional Cassandra nodes. <code class="docutils literal notranslate"><span class="pre">seeds:</span> <span class="pre">&lt;ip</span> <span class="pre">node1&gt;,&lt;ip</span> <span class="pre">node2&gt;</span></code></p>
<p>The “listen_address” should be set to the external IP address for the current Cassandra node. <code class="docutils literal notranslate"><span class="pre">listen_address:</span> <span class="pre">&lt;external</span> <span class="pre">ip</span> <span class="pre">address&gt;</span></code></p>
</div>
</div>
<div class="section" id="id3">
<h2>5.3.2.3. Installation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Copy the default configuration file located in config/storage.conf.example and change it according to your needs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ cp storage.conf.example storage.conf
</pre></div>
</div>
<p>Update the <code class="docutils literal notranslate"><span class="pre">storage.conf</span></code> file in config folder and adjust the ports and IPs to point to your cluster nodes. To build the Holmes-Storage, just run</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ go build
</pre></div>
</div>
<p>Setup the database by calling</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./Holmes-Storage --config &lt;path_to_config&gt; --setup
</pre></div>
</div>
<p>This will create the configured keyspace if it does not exist yet. For Cassandra, the default keyspace will use the following replication options:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s1">&#39;class&#39;</span>: <span class="s1">&#39;NetworkTopologyStrategy&#39;</span>, <span class="s1">&#39;dc&#39;</span>: <span class="s1">&#39;2&#39;</span><span class="o">}</span>
</pre></div>
</div>
<p>If you want to change this, you can do so after the setup by connecting with cqlsh and changing it manually. For more information about that we refer to the official documentation of Cassandra (Cassandra Replication Altering Keyspace)  You can also create the keyspace with different replication options before executing the setup and the setup won’t overwrite that. The setup will also create the necessary tables and indices.</p>
<p>Setup the object storer by calling:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./Holmes-Storage --config &lt;path_to_config&gt; --objSetup
</pre></div>
</div>
<p>Execute storage by calling:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./Holmes-Storage --config &lt;path_to_config&gt;
</pre></div>
</div>
</div>
<div class="section" id="best-practices">
<h2>5.3.2.4. Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<p>On a new cluster, Holmes-Storage will setup the database in an optimal way for the average user. However, we recommend Cassandra users to please read the <a class="reference external" href="http://cassandra.apache.org/doc/latest/operating/index.html">Cassandra’s Operations website</a> for more information Cassandra best practices. We want to expand on three particular practices that in our experience have been proven to be very meaningful in keeping the database healthy.</p>
<div class="section" id="nodetool">
<h3>5.3.2.4.1. Nodetool<a class="headerlink" href="#nodetool" title="Permalink to this headline">¶</a></h3>
<p>Based on the CAP theorem, Cassandra can be classified as an <a class="reference external" href="https://wiki.apache.org/cassandra/ArchitectureOverview">AP</a> database. The cost for strong consistency is higher latency, so the database has its own mechanisms to ensure eventual consistency in the system. However, human intervention is often necessary. It is critical that the Cassandra cluster is regularly repaired using the <code class="docutils literal notranslate"><span class="pre">nodetool</span> <span class="pre">repair</span></code> and nodetool compact command. The following documentations <a class="reference external" href="https://cassandra.apache.org/doc/latest/tools/nodetool/nodetool.html">1</a>, <a class="reference external" href="https://docs.datastax.com/en/cassandra/3.0/cassandra/tools/toolsNodetool.html">2</a> give an overview of the nodetool functionality. We suggest exploring the <a class="reference external" href="https://github.com/thelastpickle/cassandra-reaper">Cassandra-Reaper tool</a> as a potential way to automate the repair process.</p>
</div>
<div class="section" id="nodetool-repair">
<h3>5.3.2.4.2. Nodetool Repair<a class="headerlink" href="#nodetool-repair" title="Permalink to this headline">¶</a></h3>
<p>The purpose of this <a class="reference external" href="https://docs.datastax.com/en/cassandra/3.0/cassandra/tools/toolsRepair.html">command</a> is to enforce consistency in the tables across the cluster. We recommend that this is executed on every node, one at a time, at least once a week.</p>
</div>
<div class="section" id="nodetool-compact">
<h3>5.3.2.4.3. Nodetool Compact<a class="headerlink" href="#nodetool-compact" title="Permalink to this headline">¶</a></h3>
<p>This is another important maintenance <a class="reference external" href="https://docs.datastax.com/en/cassandra/3.0/cassandra/tools/toolsCompact.html">command</a>. Cassandra has its own methodology for storing and deleting data, which requires <a class="reference external" href="https://docs.datastax.com/en/cassandra/3.0/cassandra/dml/dmlHowDataMaintain.html#dmlHowDataMaintain__dmlHowDataMaintain">compaction</a> to take place in regular intervals in order to save space and maintain efficiency. For more details follow the links above to learn more about Cassandra.</p>
</div>
<div class="section" id="indexing">
<h3>5.3.2.4.4. Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h3>
<p>Holmes-Storage uses <a class="reference external" href="https://github.com/apache/cassandra/blob/trunk/doc/SASI.md">SASIIndex</a> for indexing the Cassandra database. This indexing allows for querying of large datasets with minimal overhead. When leveraging Cassandra, most of the Holmes Processing tools will automatically use SASI indexes for speed improvements. Power users wishing to learn more about how to utilize these indexes should please visit the excellent blog post by <a class="reference external" href="http://www.doanduyhai.com/blog/?p=2058">Doan DyuHai</a>.</p>
<p>However, while SASI is powerful, it is not meant to be a replacement for advanced search and aggregation engines like <a class="reference external" href="http://lucene.apache.org/solr/">Solr</a>, <a class="reference external" href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a>, or leveraging <a class="reference external" href="https://spark.apache.org">Spark</a>. Additionally, Holmes Storage by default does not implement SASI on the table for storing the results of TOTEM Services (results.results). This is because indexing this field can increase storage costs by approximately 40% on standard deployments. If you still wish to leverage SASI on results.results, the following Cassandra command will provide a sane level of indexing.</p>
<p>SASI indexing of TOTEM Service results. WARNING: this will greatly increase storage requirement:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span>CREATE CUSTOM INDEX results_results_idx ON holmes_testing.results (results)
USING &#39;org.apache.cassandra.index.sasi.SASIIndex&#39;
WITH OPTIONS = {
        &#39;analyzed&#39; : &#39;true&#39;,
        &#39;analyzer_class&#39; : &#39;org.apache.cassandra.index.sasi.analyzer.StandardAnalyzer&#39;,
        &#39;tokenization_enable_stemming&#39; : &#39;false&#39;,
        &#39;tokenization_locale&#39; : &#39;en&#39;,
        &#39;tokenization_normalize_lowercase&#39; : &#39;true&#39;,
        &#39;tokenization_skip_stop_words&#39; : &#39;true&#39;,
        &#39;max_compaction_flush_memory_in_mb&#39;: &#39;512&#39;
};
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../holmes-gateway/index.html" class="btn btn-neutral float-right" title="5.4. Holmes Gateway" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="5.3.1. Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Holmes Processing

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>